
\documentclass[%
  aspectratio=169,
  9pt,
  USenglish,
  titlegraphic, % store custom image to .images/titlegraphic
  %affiliationintitlepagehead,
  progressbar,
%   affiliation,
]{beamer}
%\texttt{}

\usetheme{TUM}


\newcommand{\coorg}{Irisa}


\setbeamertemplate{blocks}[rounded][shadow=false]

\input{preamble.tex}

\title{Early Classification for Agricultural Monitoring}
\subtitle{from Satellite Time Series}
\author[M. Rußwurm, R. Tavenard, S. Lefèvre, M.Körner]{Marc Rußwurm, Romain Tavenard, Sébastien Lefèvre, Marco Körner}
\institute[TUM, IRISA-Obelix, LETG-Rennes]{Technical University of Munich, Germany\\
                Remote Sensing Technology}
\date{\today}

\begin{document}
\begin{frame}[t]
  \titlepage
\end{frame}



{\setbeamercolor{background canvas}{bg=tumgraylight}
	\begin{frame}[plain]
	\vfill
	\Huge\color{tumbluedark}
	\begin{columns}
		\column{.5\textwidth}
		\vspace{4em}
		
		\hfill \textbf{Early} Time Series \\\hfill Classification
		\column{.5\textwidth}
		\includegraphics[width=4cm]{images/TUM-blue}
		
		\vspace{1em}
		\includegraphics[width=7cm]{images/Irisa}
	\end{columns}
	%		\includegraphics[width=5cm]{images/TUM-white}
	%		\includegraphics[width=7cm]{images/Irisa}
	
	\vfill
\end{frame}
}


\begin{frame}
\frametitle{Winter Research Stay at IRISA Obelix Lab in France}

\begin{columns}
\column{.5\textwidth}

Research Stay
\begin{itemize}[itemsep=1em]
	\item Prof. \textbf{Sebastien Lefèvre} and Prof. \textbf{Romain Tavenard}
	\item Obelix: \textbf{Environment observation} with \textbf{complex imagery}
	\item Vannes and Rennes, Britanny, France
\end{itemize}

\vspace{1em}
\url{http://www-obelix.irisa.fr/}

\column{.5\textwidth}

\includegraphics[width=5cm]{images/map/europe}

\end{columns}

\end{frame}


\tikzstyle{rnn}=[draw,circle]
\tikzstyle{annot}=[rounded corners, fill=colorblue!20]
\colorlet{colortrain}{colorblue}
\colorlet{colorinfer}{colororange}
\tikzstyle{infer}=[-stealth, shorten >=.0em, shorten <=.0em, colorinfer]
\tikzstyle{loss}=[fill=colorblue!10, rounded corners, font=\small]
\tikzstyle{grad}=[colortrain]

\newcommand{\classimagepair}[1]{
\def\sample{#1}
\begin{tikzpicture}[node distance=.2em]
\node[label=above:{inputs $\V{x}_t$}](a){\includegraphics[width=.5\textwidth]{images/classification_without_earliness/TwoPatterns30EpochsNoEarliness/sample_\sample_x.png}};
\node[label=above:{softmaxed class scores $\yhat_t$}, right=of a](b){\includegraphics[width=.5\textwidth]{images/classification_without_earliness/TwoPatterns30EpochsNoEarliness/sample_\sample_p(y).png}};

\visible<2->{
%\draw (-2,-2) to[grid with coordinates] (8,4);
\node[annot, yshift=3em](wiggle1) at ($ (a)!0.3!(b) $) {event \#1};
\draw (wiggle1) -- (-1.5,0);
\draw (wiggle1) -- (5.5,-1);
}
\visible<3->{
\node[annot, yshift=-5em](wiggle2) at ($ (a)!0.3!(b) $) {event \#2};
\draw (wiggle2) -- (1,0);
\draw (wiggle2) -- (7.5,0);
}

\visible<4->{
\draw[very thick] (8.5,-2) -- (8.5,2); 
\node[annot, yshift=-5em, anchor=east](stop) at (10,-1) {...we could stop here};
%		\draw[shorten >=1em] (stop)++(2,0.5) -- (8,0);
}
\end{tikzpicture}
}

\begin{frame}<presentation:1-4>{Class Predictions}
\classimagepair{0}
\end{frame}

\begin{frame}
\frametitle{ArXiv Paper: End-to-end Learning for Early Classification of Time Series}

\begin{columns}


\column{.5\textwidth}

Rußwurm, M., Lefèvre, S., Courty, N., Emonet, R., Körner, M., \& Tavenard, R. (2019).\textbf{ End-to-end Learning for Early Classification of Time Series}. arXiv preprint arXiv:1901.10681.

\vspace{1em}
https://github.com/rtavenar/early\_rnn

\column{.5\textwidth}

\includegraphics[width=4cm]{images/elects_arxiv}

\end{columns}

\end{frame}



%\begin{frame}
%	\frametitle{Autoregressive Classification Model}
%	
%	\input{images/classmodel.tikz}
%	
%\end{frame}


\begin{frame}
\frametitle{Early Classification on Remote Sensing Data}
\input{images/example.tikz}

\url{https://arxiv.org/abs/1901.10681}


\end{frame}

\begin{frame}
\frametitle{Stopping times per crop Class}

\input{images/classboxplots.tikz}

\end{frame}

\begin{frame}
\frametitle{Impact of Early Classification on Vegetation Data}

\Large

\begin{itemize}[itemsep=1em]
\item<1-> \textbf{supervised end-to-end} learning scenario
\item<2-> we get a stopping time \textbf{for free} solely from classifying labels
\item<3-> relate to \textbf{characteristic features}, i.e., \textbf{crop phenology}
\item<4-> next: assess seasonal shifts in \textbf{vegetation phenology} due to \textbf{environmental conditions}
\end{itemize}

\end{frame}

\begin{frame}
	\frame{AOI}
	
	\begin{columns}
		\column{.5\textwidth}
			\centering\includegraphics[width=3cm]{images/holl.pdf}
			The area of interest and partitioning in blocks of 4.5 km for training validation and evaluation
			
		\column{.5\textwidth}
			\input{images/partition_histograms.tikz}
			{Class distribution in the dataset with block-wise separation of train, valid and evaluation partitions.}
	
\end{columns}
\end{frame}

\begin{frame}
	
	
	\input{images/loss-accuracyplots.tikz}


	\begin{columns}
	\column{.5\textwidth}
\figtwophasecrossentropy
{two-phase training first optimizing for accuracy-only and then for early classifications as well using \emph{lateness penalty} loss.}

	\column{.5\textwidth}
\figearlyreward
{one training phase using the \emph{earliness reward} formulation.}
\end{columns}
	
	
\end{frame}


\begin{frame}

	
	\begin{table}
		\caption{Varying the weighting factor $\alpha$ for the two loss formulations \emph{early reward} (\cref{sec:earlynessreward}) and \emph{lateness penalty} (\cref{sec:twophasecrossentropy}).}
		\label{tab:alpha}
		
		\setlength{\belowcaptionskip}{0pt}
		
		\begin{subtable}{.5\textwidth}
			\scriptsize
			\hspace{0em}\begin{tabular}{lcccccc}
				\toprule
				\textbf{$\alpha$} & accuracy & $\meantstop$ & precision & recall & $f_1$ & $\kappa$ \\
				\cmidrule(lr){0-0}\cmidrule(lr){1-1}\cmidrule(lr){2-2}\cmidrule(lr){3-3}\cmidrule(lr){4-4}\cmidrule(lr){5-5}\cmidrule(lr){6-6}\cmidrule(lr){7-7}
				.0 & .24 $\pm$ .29 & .00 $\pm$ .00 & .04 $\pm$ .04 & .15 $\pm$ .00 & .05 $\pm$ .05 & .00 $\pm$ .00 \\
				.2 & .15 $\pm$ .08 & .00 $\pm$ .00 & .10 $\pm$ .05 & .15 $\pm$ .01 & .08 $\pm$ .03 & .01 $\pm$ .01 \\
				.4 & .79 $\pm$ .05 & .39 $\pm$ .03 & .67 $\pm$ .05 & .71 $\pm$ .04 & .68 $\pm$ .04 & .69 $\pm$ .06 \\
				.6 & .83 $\pm$ .03 & .59 $\pm$ .17 & .71 $\pm$ .03 & .74 $\pm$ .02 & .72 $\pm$ .02 & .74 $\pm$ .04 \\
				.8 & .86 $\pm$ .01 & .86 $\pm$ .12 & .74 $\pm$ .01 & .76 $\pm$ .02 & .75 $\pm$ .02 & .79 $\pm$ .01 \\
				1.0 & .86 $\pm$ .01 & 1.00 $\pm$ .00 & .75 $\pm$ .02 & .76 $\pm$ .02 & .75 $\pm$ .02 & .79 $\pm$ .02 \\
				\bottomrule
			\end{tabular}
			\caption{two-phase \emph{lateness penalty} loss formulation}
			\label{tab:alpha:xentropy}
		\end{subtable}
		\begin{subtable}{.5\textwidth}
			\scriptsize
			\hspace{0em}\begin{tabular}{lcccccc}
				\toprule\small
				\textbf{$\alpha$} & accuracy & $\meantstop$  & precision & recall & $f_1$ & $\kappa$ \\
				\cmidrule(lr){0-0}\cmidrule(lr){1-1}\cmidrule(lr){2-2}\cmidrule(lr){3-3}\cmidrule(lr){4-4}\cmidrule(lr){5-5}\cmidrule(lr){6-6}\cmidrule(lr){7-7}
				.0 & .25 $\pm$ .22 & .10 $\pm$ .17 & .19 $\pm$ .20 & .25 $\pm$ .17 & .16 $\pm$ .20 & .12 $\pm$ .19 \\
				.2 & .81 $\pm$ .03 & .40 $\pm$ .02 & .70 $\pm$ .01 & .74 $\pm$ .01 & .71 $\pm$ .01 & .71 $\pm$ .04 \\
				.4 & .80 $\pm$ .09 & .47 $\pm$ .03 & .71 $\pm$ .02 & .74 $\pm$ .01 & .71 $\pm$ .02 & .71 $\pm$ .10 \\
				.6 & .85 $\pm$ .02 & .88 $\pm$ .07 & .73 $\pm$ .04 & .74 $\pm$ .03 & .73 $\pm$ .03 & .77 $\pm$ .03 \\
				.8 & .84 $\pm$ .01 & .93 $\pm$ .05 & .72 $\pm$ .02 & .75 $\pm$ .01 & .73 $\pm$ .02 & .76 $\pm$ .02 \\
				1.0 & .83 $\pm$ .03 & 1.00 $\pm$ .00 & .72 $\pm$ .03 & .75 $\pm$ .01 & .72 $\pm$ .03 & .75 $\pm$ .04 \\
				\bottomrule
			\end{tabular}
			\caption{one phase \emph{early-reward} formulation}
			\label{tab:alpha:earlyreward}
		\end{subtable}
		
	\end{table}

\end{frame}

\begin{frame}
	
		\input{images/epsilonexperiment.tikz}
		\figepsilonzero
		{The three runs with different random initialization per $\ptoffset$ offset and $\alpha=0.4$ of \cref{tab:epsilon:a04}.
			The $\ptoffset>0$ offset factor allows the models to recover from a too early classification, as is visible in the top two plots.}
	
\end{frame}

\begin{frame}
	
	
	\begin{table}
		\caption{Quantitative analysis of the $\ptoffset$ parameter on different trade-off factors between $\alpha$ earliness and accuracy. The illustrated figures show the mean and standard deviation of three runs with same parameters, but different initial random initialization.}
		\label{tab:epsilon:quantitative}
		\setlength{\belowcaptionskip}{0pt}
		
		\begin{subtable}{.5\textwidth}
			\scriptsize
			%\begin{tabular}{lcccccc}
			%	\toprule
			%	\textbf{$\ptoffset$} & accuracy & earliness & $f_1$ & precision & recall & $\kappa$ \\
			%	\cmidrule(lr){0-0}\cmidrule(lr){1-1}\cmidrule(lr){2-2}\cmidrule(lr){3-3}\cmidrule(lr){4-4}\cmidrule(lr){5-5}\cmidrule(lr){6-6}\cmidrule(lr){7-7}
			%0 & .05 $\pm$ .00 & .00 $\pm$ .00 & .01 $\pm$ .00 & .01 $\pm$ .00 & .14 $\pm$ .00 & .00 $\pm$ .00 \\
			%1 & .41 $\pm$ .26 & .08 $\pm$ .13 & .12 $\pm$ .09 & .11 $\pm$ .09 & .19 $\pm$ .07 & .11 $\pm$ .17 \\
			%10 & .25 $\pm$ .22 & .10 $\pm$ .17 & .16 $\pm$ .20 & .19 $\pm$ .20 & .25 $\pm$ .17 & .12 $\pm$ .19 \\
			%	\bottomrule
			%\end{tabular}
			%\caption{\emph{$\alpha=0$}}
			%\label{tab:epsilon:a0}
			\hspace{-1em}\begin{tabular}{lcccccc}
				\toprule
				\textbf{$\ptoffset$} & accuracy & $\meantstop$  & $f_1$ & precision & recall & $\kappa$ \\
				\cmidrule(lr){0-0}\cmidrule(lr){1-1}\cmidrule(lr){2-2}\cmidrule(lr){3-3}\cmidrule(lr){4-4}\cmidrule(lr){5-5}\cmidrule(lr){6-6}\cmidrule(lr){7-7}
				0 & .10 $\pm$ .02 & .02 $\pm$ .00 & .07 $\pm$ .01 & .13 $\pm$ .06 & .17 $\pm$ .00 & .02 $\pm$ .00 \\
				1 & .75 $\pm$ .09 & .44 $\pm$ .06 & .65 $\pm$ .05 & .64 $\pm$ .03 & .69 $\pm$ .03 & .64 $\pm$ .10 \\
				10 & .81 $\pm$ .03 & .40 $\pm$ .02 & .71 $\pm$ .01 & .70 $\pm$ .01 & .74 $\pm$ .01 & .71 $\pm$ .04 \\
				\bottomrule
			\end{tabular}
			\caption{\emph{$\alpha=0.2$}}
			\label{tab:epsilon:a02}
		\end{subtable}
		\begin{subtable}{.5\textwidth}
			\scriptsize
			\hspace{-1em}\begin{tabular}{lcccccc}
				\toprule
				\textbf{$\ptoffset$} & accuracy & $\meantstop$  & $f_1$ & precision & recall & $\kappa$ \\
				\cmidrule(lr){0-0}\cmidrule(lr){1-1}\cmidrule(lr){2-2}\cmidrule(lr){3-3}\cmidrule(lr){4-4}\cmidrule(lr){5-5}\cmidrule(lr){6-6}\cmidrule(lr){7-7}
				0 & .21 $\pm$ .20 & .02 $\pm$ .00 & .09 $\pm$ .04 & .18 $\pm$ .03 & .16 $\pm$ .01 & .04 $\pm$ .03 \\
				1 & .80 $\pm$ .02 & .50 $\pm$ .05 & .68 $\pm$ .05 & .67 $\pm$ .05 & .70 $\pm$ .07 & .70 $\pm$ .03 \\
				10 & .80 $\pm$ .09 & .47 $\pm$ .03 & .71 $\pm$ .02 & .71 $\pm$ .02 & .74 $\pm$ .01 & .71 $\pm$ .10 \\
				\bottomrule
			\end{tabular}
			\caption{\emph{$\alpha=0.4$}}
			\label{tab:epsilon:a04}
		\end{subtable}
		\begin{subtable}{.5\textwidth}
			\scriptsize
			\hspace{-1em}\begin{tabular}{lcccccc}
				\toprule
				\textbf{$\ptoffset$} & accuracy & $\meantstop$  & $f_1$ & precision & recall & $\kappa$ \\
				\cmidrule(lr){0-0}\cmidrule(lr){1-1}\cmidrule(lr){2-2}\cmidrule(lr){3-3}\cmidrule(lr){4-4}\cmidrule(lr){5-5}\cmidrule(lr){6-6}\cmidrule(lr){7-7}
				0 & .13 $\pm$ .04 & .02 $\pm$ .00 & .08 $\pm$ .01 & .16 $\pm$ .01 & .16 $\pm$ .01 & .02 $\pm$ .01 \\
				1 & .80 $\pm$ .05 & .85 $\pm$ .14 & .71 $\pm$ .02 & .70 $\pm$ .02 & .74 $\pm$ .01 & .70 $\pm$ .06 \\
				10 & .85 $\pm$ .02 & .88 $\pm$ .07 & .73 $\pm$ .03 & .73 $\pm$ .04 & .74 $\pm$ .03 & .77 $\pm$ .03 \\
				\bottomrule
			\end{tabular}
			\caption{\emph{$\alpha=0.6$}}
			\label{tab:epsilon:a06}
		\end{subtable}
		\begin{subtable}{.5\textwidth}
			\scriptsize
			\hspace{-1em}\begin{tabular}{lcccccc}
				\toprule
				\textbf{$\ptoffset$} & accuracy & $\meantstop$  & $f_1$ & precision & recall & $\kappa$ \\
				\cmidrule(lr){0-0}\cmidrule(lr){1-1}\cmidrule(lr){2-2}\cmidrule(lr){3-3}\cmidrule(lr){4-4}\cmidrule(lr){5-5}\cmidrule(lr){6-6}\cmidrule(lr){7-7}
				0 & .11 $\pm$ .03 & .03 $\pm$ .01 & .08 $\pm$ .02 & .15 $\pm$ .02 & .17 $\pm$ .01 & .02 $\pm$ .01 \\
				1 & .84 $\pm$ .03 & .98 $\pm$ .03 & .73 $\pm$ .03 & .72 $\pm$ .04 & .75 $\pm$ .02 & .76 $\pm$ .04 \\
				10 & .84 $\pm$ .01 & .93 $\pm$ .05 & .73 $\pm$ .02 & .72 $\pm$ .02 & .75 $\pm$ .01 & .76 $\pm$ .02 \\
				\bottomrule
			\end{tabular}
			\caption{\emph{$\alpha=0.8$}}
			\label{tab:epsilon:a08}
		\end{subtable}
		%\begin{subtable}{.5\textwidth}
		%	\scriptsize
		%	\hspace{-1em}\begin{tabular}{lcccccc}
		%		\toprule
		%		\textbf{$\ptoffset$} & accuracy & $\meantstop$ & $f_1$ & precision & recall & $\kappa$ \\
		%		\cmidrule(lr){0-0}\cmidrule(lr){1-1}\cmidrule(lr){2-2}\cmidrule(lr){3-3}\cmidrule(lr){4-4}\cmidrule(lr){5-5}\cmidrule(lr){6-6}\cmidrule(lr){7-7}
		%0 & .39 $\pm$ .30 & 1.00 $\pm$ .00 & .14 $\pm$ .15 & .13 $\pm$ .15 & .23 $\pm$ .14 & .12 $\pm$ .21 \\
		%1 & .74 $\pm$ .14 & 1.00 $\pm$ .00 & .51 $\pm$ .36 & .50 $\pm$ .36 & .55 $\pm$ .35 & .49 $\pm$ .42 \\
		%10 & .83 $\pm$ .03 & 1.00 $\pm$ .00 & .72 $\pm$ .03 & .72 $\pm$ .03 & .75 $\pm$ .01 & .75 $\pm$ .04 \\
		%		\bottomrule
		%	\end{tabular}
		%	\caption{\emph{$\alpha=1.0$}}
		%	\label{tab:epsilon:a1}
		%\end{subtable}
		
	\end{table}
	
\end{frame}

\begin{frame}
	
	
		\input{images/trainingstoppingclasses.tikz}
		{Class-wise analysis of the estimated stopping time during training in the evaluation set.}
	
\end{frame}

\begin{frame}
	\begin{columns}
	\column{.5\textwidth}
	\includegraphics[width=.6\textwidth]{images/AI4SG_Poster}
	
	\column{.5\textwidth}
	\includegraphics[width=.6\textwidth]{images/AI4SG_Paper}
	
	\end{columns}
\end{frame}

\begin{frame}
	
	\begin{equation}
	P(t;\deltauptot) = \delta_t \cdot \prod_{\tau=0}^{t-1} 1 - \delta_\tau \, .
	\label{eq:pts}
	\end{equation}
	
	\begin{equation}
	\mathcal{L}(\V{x}, \V{y}) = \sum_{t=0}^T P(t;\deltauptot) \mathcal{L}_t(\xuptot, \V{y}) \, .
	\label{eq:ptloss}
	\end{equation}
	
	\begin{equation}
	\mathcal{L}_\text{e}(\xuptot, \V{y} ; \alpha) = \alpha \mathcal{L}_\text{e} (\xuptot, \V{y}) + \left(1-\alpha\right) \mathcal{L}_\text{e}(t)
	\label{eq:lt}
	\end{equation}
	
	\begin{equation}
	\mathcal{L}_\text{e}(t) = \frac{t}{T}
	\label{eq:loss:earliness}
	\end{equation}
	
	\begin{equation}
	\mathcal{L}_t(\xuptot, \V{y} ; \alpha) = \alpha \mathcal{L}_c (\xuptot, \V{y}) - (1 - \alpha)\mathcal{R}_e(t, \ycorrect_t)
	\label{eq:earlyrewardloss}
	\end{equation} 
	
	\begin{equation}
	\mathcal{R}_e(t, \ycorrect_t) = \ycorrect_t \left(1 - \frac{t}{T}\right) \,.
	\label{eq:earlyrewardterm}
	\end{equation}
	
	\begin{equation}
	P^\prime(t;\deltauptot) = P(t;\deltauptot) + \frac{\ptoffset}{T}
	\end{equation}
	
\end{frame}

\begin{frame}
	
		\centering\input{images/lstmmodel.tikz}
	
\end{frame}

\end{document}



